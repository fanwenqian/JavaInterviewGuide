[TOC]

### OSI - 七层模型？

OSI，即开放式系统互联通信参考模型

**OSI 七层模型** 是国际标准化组织提出一个网络分层模型，其大体结构以及每一层提供的功能如下图所示：

![OSI 七层模型](img\osi-7-model.png)

每一层都专注做一件事情，并且每一层都需要使用下一层提供的功能比如传输层需要使用网络层提供的路由和寻址功能，这样传输层才知道把数据传输到哪里去。

**OSI 的七层体系结构概念清楚，理论也很完整，但是它比较复杂而且不实用，而且有些功能在多个层中重复出现。**

上面这种图可能比较抽象，再来一个比较生动的图片。下面这个图片是我在国外的一个网站上看到的，非常赞！

![osi七层模型2](img\osi七层模型2.png)

### 既然 OSI 七层模型这么厉害，为什么干不过 TCP/IP 四层模型呢？

的确，OSI 七层模型当时一直被一些大公司甚至一些国家政府支持。这样的背景下，为什么会失败呢？我觉得主要有下面几方面原因：

- OSI 的专家缺乏实际经验，他们在完成 OSI 标准时缺乏商业驱动力
- OSI 的协议实现起来过分复杂，而且运行效率很低
- OSI 制定标准的周期太长，因而使得按 OSI 标准生产的设备无法及时进入市场（20 世纪 90 年代初期，虽然整套的 OSI 国际标准都已经制定出来，但基于 TCP/IP 的互联网已经抢先在全球相当大的范围成功运行了）
- OSI 的层次划分不太合理，有些功能在多个层次中重复出现。

OSI 七层模型虽然失败了，但是却提供了很多不错的理论基础。为了更好地去了解网络分层，OSI 七层模型还是非常有必要学习的。

![img](img\osi-model-detail.png)

### TCP/IP 四层模型？

**TCP/IP 四层模型** 是目前被广泛采用的一种模型,我们可以将 TCP / IP 模型看作是 OSI 七层模型的精简版本，由以下 4 层组成：

![TCP/IP 各层协议概览](img\network-protocol-overview.png)



### TCP 与 UDP 的区别？

- **是否面向连接** ：TCP在传送数据之前必须先建立连接，数据传送结束后要释放连接。UDP不需要。
- **是否是可靠传输**：TCP 提供可靠的传输服务，TCP 在传递数据之前，会有三次握手来建立连接，而且在数据传递时，有确认、窗口、重传、拥塞控制机制。通过 TCP 连接传输的数据，无差错、不丢失、不重复、并且按序到达。远程主机在收到 UDP 报文后，不需要给出任何确认，并且不保证数据不丢失，不保证是否顺序到达。
- **是否有状态** ：这个和上面的“是否可靠传输”相对应。TCP 传输是有状态的，这个有状态说的是 TCP 会去记录自己发送消息的状态比如消息是否发送了、是否被接收了等等。为此 ，TCP 需要维持复杂的连接状态表。而 UDP 是无状态服务，简单来说就是不管发出去之后的事情了。
- **传输效率** ：由于使用 TCP 进行传输的时候多了连接、确认、重传等机制，所以 TCP 的传输效率要比 UDP 低很多。
- **传输形式** ：TCP 是面向字节流的，UDP 是面向报文的。
- **首部开销** ：TCP 首部开销（20 ～ 60 字节）比 UDP 首部开销（8 字节）要大。
- **是否提供广播或多播服务** ：TCP 只支持点对点通信，UDP 支持一对一、一对多、多对一、多对多；
- ...

![](img\image-20220825142437182.png)

### 什么时候用 TCP,什么时候用 UDP?

- **UDP 一般用于即时通信**，比如： 语音、 视频 、直播等等。这些场景对传输数据的准确性要求不是特别高，比如你看视频即使少个一两帧，实际给人的感觉区别也不大。
- **TCP 用于对传输准确性要求特别高的场景**，比如文件传输、发送和接收邮件、远程登录等等。

### TCP 三次握手和四次挥手？

##### 建立连接 ——》 三次握手

![TCP 三次握手图解](img\tcp-shakes-hands-three-times.png)

建立一个 TCP 连接需要“三次握手”，缺一不可 ：

- **一次握手**：客户端发送带有 SYN（SEQ=x）标志的数据包 --》 服务端，然后客户端进入**SYN_SEND** 状态，等待服务器的确认。
- **二次握手**：服务端发送带有 SYN + ACK(SEQ=y,ACK=x+1) 标志的数据包 --》 客户端,然后服务端进入 **SYN_RECV** 状态
- **三次握手**：客户端发送带有带有 ACK(ACK=y+1) 标志的数据包 --》 服务端，然后客户端和服务器端都进入**ESTABLISHED** 状态，完成TCP三次握手。

**当建立了 3 次握手之后，客户端和服务端就可以传输数据啦！**



##### 断开连接 ——》 四次挥手





### HTTP 基于 TCP 还是 UDP？

**HTTP 协议是基于 TCP 协议的**，所以发送 HTTP 请求之前首先要建立 TCP 连接也就是要经历 3 次握手。

